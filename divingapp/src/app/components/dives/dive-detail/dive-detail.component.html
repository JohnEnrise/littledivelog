
<form
    (keydown.enter)="onEnter($event)"
    [formGroup]="form"
    class="form-horizontal dive-details"
    *ngIf="dive !== undefined"
    (ngSubmit)="onSubmit($event)"
>
    <div class="detail-menu">
        <button class="btn btn-lg btn-primary" type="submit" [disabled]="!form.valid || !form.dirty" title="Save dive"><i class="fa fa-floppy-o"></i></button>
        <button class="btn btn-lg btn-primary" (click)="reset()" [disabled]="!form.dirty" title="Undo unsaved changes"><i class="fa fa-undo"></i></button>
        <button class="btn btn-lg btn-primary" (click)="back()"  [appHideWhenDesktop]="true" title="Go back"><i class="fa fa-arrow-left"></i></button>
    </div>

    <div class="form-content">
        <!-- Nav tabs -->
        <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" href="#dive" aria-controls="dive" role="tab" data-toggle="tab">Dive</a>
            </li>
            <li class="nav-item" [hidden]="dive.id === undefined || diveProfile.data.length === 0" >
                <a class="nav-link" href="#profile" aria-controls="profile" role="tab" data-toggle="tab">Profile</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#delete" aria-controls="delete" role="tab" data-toggle="tab">Delete</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#debug" aria-controls="debug" role="tab" data-toggle="tab">Debug</a>
            </li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content">
            <div role="tabpanel" class="tab-pane active" id="dive">

                <div [ngClass]="{ 'form-group row':true, 'has-danger': !form.controls.date.valid }">
                    <label class="col-sm-2 control-label">Date</label>
                    <div class="col-sm-10">
                        <input class="form-control" formControlName="date" placeholder="{{CurrentDate}}" /> <!--  | date: 'y-MM-dd HH:mm:ss' -->
                        <small class="has-danger error-text" *ngIf="form.controls.date.errors?.required">
                            Date is required
                        </small>
                        <small class="has-danger error-text" *ngIf="form.controls.date.errors?.invalid">
                            Date must be a valid date, eg 2017-07-22 22:59:59
                        </small>
                    </div>
                </div>
                <div [ngClass]="{ 'form-group row':true, 'has-danger': !form.controls.divetime.valid }">
                    <label class="col-sm-2 control-label">Dive time</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" formControlName="divetime" placeholder="00:00:00" />
                        <small class="has-danger error-text" *ngIf="form.controls.divetime.errors?.required">
                            Divetime is required
                        </small>
                        <small class="has-danger error-text" *ngIf="form.controls.divetime.errors?.invalid">
                            Divetime must be a valid duration; eg. 00:00:00
                        </small>
                    </div>
                </div>
                <div [ngClass]="{ 'form-group row':true, 'has-danger': !form.controls.maxDepth.valid }">
                    <label class="col-sm-2 control-label">Max depth</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" formControlName="maxDepth" placeholder="0.00" /> <!-- number: "1.1-1" -->
                        <small class="has-danger error-text" *ngIf="form.controls.maxDepth.errors?.required">
                            Max depth is required
                        </small>
                        <small class="has-danger error-text" *ngIf="form.controls.maxDepth.errors?.pattern">
                            Max depth must be a valid numer; eg. 10.05
                        </small>
                    </div>
                </div>
                <div [ngClass]="{ 'form-group row':true, 'has-danger': !form.controls.tank.valid }">
                    <label class="hidden-xs col-sm-2 control-label">Tank</label>
                    <div class="col-sm-10">

                        <div class="row">
                            <div class="col">
                                <label>
                                    Tank Volume
                                </label>
                            </div>
                            <div class="col">
                                <label>
                                    Ogygen percentage
                                </label>
                            </div>
                        </div>
                        <div class="input-group-group" formGroupName="tank">
                            <div class="input-group">
                                <input type="text" class="form-control" formControlName="volume" placeholder="10" required />
                                <span class="input-group-addon">L</span>
                                <input type="text" class="form-control" formControlName="airPercentage" placeholder="21" required />
                                <span class="input-group-addon">%</span>
                            </div>
                            <div class="input-group" width="100%">
                                <input type="text" class="form-control" formControlName="pressureStart" placeholder="200" required />
                                <span class="input-group-btn" style="width:0px;"></span>
                                <input type="text" class="form-control" formControlName="pressureEnd" placeholder="50" required />
                                <div class="dropdown">
                                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        {{form.controls.tank.controls.pressureType.value}}
                                    </button>
                                    <div class="dropdown-menu dropdown-menu-right">
                                        <a class="dropdown-item" (click)="form.controls.tank.controls.pressureType.setValue('bar')">bar</a>
                                        <a class="dropdown-item" (click)="form.controls.tank.controls.pressureType.setValue('psi')">psi</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <label>
                                    Start Pressure
                                </label>
                            </div>
                            <div class="col">
                                <label>
                                    End Pressure
                                </label>
                            </div>
                        </div>

                        <small class="has-danger error-text" *ngIf="form.controls.tank.controls.volume.errors?.required">
                            Tank volume is required
                        </small>
                        <small class="has-danger error-text" *ngIf="form.controls.tank.controls.volume.errors?.invalid">
                            Tank volume must be a valid integer; eg 10
                        </small>

                        <small class="has-danger error-text" *ngIf="form.controls.tank.controls.airPercentage.errors?.required">
                            Oxygen percentage is required
                        </small>
                        <small class="has-danger error-text" *ngIf="form.controls.tank.controls.airPercentage.errors?.invalid">
                            Oxygen percentage must be an integer number; eg 21
                        </small>

                        <small class="has-danger error-text" *ngIf="form.controls.tank.controls.pressureStart.errors?.required">
                            Start pressure is required
                        </small>
                        <small class="has-danger error-text" *ngIf="form.controls.tank.controls.pressureStart.errors?.invalid">
                            Start pressure must be a valid number; eg 10.05
                        </small>

                        <small class="has-danger error-text" *ngIf="form.controls.tank.controls.pressureEnd.errors?.required">
                            End pressure is required
                        </small>
                        <small class="has-danger error-text" *ngIf="form.controls.tank.controls.pressureEnd.errors?.invalid">
                            End pressure must be a valid number; eg 10.05
                        </small>

                    </div>
                </div>
                <div [ngClass]="{ 'form-group row':true, 'has-danger': !form.controls.place.valid  }">
                    <label class="col-sm-2 control-label">Divespot</label>
                    <div class="col-sm-10">

                        <div class="input-group manual-radius" style="width: 100%" formGroupName="place">
                            <app-autocomplete
                                placeholder="Name"
                                inputClass="form-control left-control"
                                [value]="form.controls.place.controls.name.value"
                                [source]="getDivespots.bind(this)"
                                [newItem]="newDiveSpot.bind(this)"
                                (changed)="diveSpotChanged($event)"
                                displayItem="name"
                            ></app-autocomplete>
                            <span class="input-group-btn" style="width:0px;"></span>
                            <app-autocomplete
                                placeholder="Country"
                                inputClass="form-control right-control"
                                formControlName="country"
                                [source]="getCountries.bind(this)"
                                (changed)="diveCountryChanged($event)"
                                displayItem="description"
                                keyItem="code"
                                forceSelection="true"
                            ></app-autocomplete>
                        </div>
                        <small class="has-danger error-text">
                            Both or none need to be filled
                        </small>

                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-sm-2 control-label">Buddies</label>
                    <div class="col-sm-10">
                        <app-tags-control
                            formControlName="buddies"
                            placeholder="Myke"
                            [source]="getBuddies.bind(this)"
                        ></app-tags-control>
                    </div>
                </div>

                <div class="form-group row">
                    <label class="col-sm-2 control-label">Tags</label>
                    <div class="col-sm-10">
                        <app-tags-control
                            formControlName="tags"
                            placeholder="Deco"
                            [source]="getTags.bind(this)"
                        ></app-tags-control>
                    </div>
                </div>

            </div>

            <div role="tabpanel" class="tab-pane" id="profile">
                <app-dive-profile #diveProfile [dive]="dive"></app-dive-profile>
            </div>

            <div role="tabpanel" class="tab-pane" id="delete">
                <div class="alert alert-warning">
                    <h3>Delete this dive?</h3>
                    <p>Are your sure you want to permanently delete this dive?</p>
                    <button type="button" class="btn btn-danger" (click)="delete()">
                        Yes, delete this dive.
                    </button>
                </div>
            </div>

            <div role="tabpanel" class="tab-pane" id="debug">
                <div class="card">
                    <div class="card-body">
                        <pre><code>{{ diagnostic | json }}</code></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>