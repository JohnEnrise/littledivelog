<form  [formGroup]="form" class="form-horizontal dive-details" *ngIf="dive !== undefined" (ngSubmit)="onSubmit(form)">
    <div class="detail-menu">
        <button class="btn btn-primary" [routerLink]="['/dive']"  [appHideWhenDesktop]="true" title="Go back"><i class="fa fa-arrow-left"></i> Back</button>
        <button class="btn btn-primary" (click)="reset()" [disabled]="!form.dirty" title="Undo unsaved changes"><i class="fa fa-undo"></i> Reset</button>
        <button class="btn btn-primary" type="submit" [disabled]="!form.valid || !form.dirty" title="Save dive"><i class="fa fa-floppy-o"></i> Save</button>
    </div>
    <div class="clear-fix visible-xs-block"></div>
    <div class="form-content">
        <!-- Nav tabs -->
        <ul class="nav nav-tabs" role="tablist">
            <li role="presentation" class="active"><a href="#dive" aria-controls="dive" role="tab" data-toggle="tab">Dive</a></li>
            <li role="presentation"><a href="#profile" aria-controls="profile" role="tab" data-toggle="tab">Profile</a></li>
            <li role="presentation"><a href="#debug" aria-controls="debug" role="tab" data-toggle="tab">Debug</a></li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content">
            <div role="tabpanel" class="tab-pane active" id="dive">
                
                <div [ngClass]="{ 'form-group':true, 'has-error': !form.controls.date.valid }">
                    <label class="col-sm-2 control-label">Date</label>
                    <div class="col-sm-10">
                        <input class="form-control" formControlName="date" placeholder="{{CurrentDate}}" /> <!--  | date: 'y-MM-dd HH:mm:ss' -->
                        <small class="help-text on-error" *ngIf="form.controls.date.errors?.required">
                            Date is required
                        </small>
                        <small class="help-text on-error" *ngIf="form.controls.date.errors?.invalid">
                            Date must be a valid date, eg 2017-07-22 22:59:59
                        </small>
                    </div>
                </div>
                <div [ngClass]="{ 'form-group':true, 'has-error': !form.controls.divetime.valid }">
                    <label class="col-sm-2 control-label">Dive time</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" formControlName="divetime" placeholder="00:00:00" />
                        <small class="help-text on-error" *ngIf="form.controls.divetime.errors?.required">
                            Divetime is required
                        </small>
                        <small class="help-text on-error" *ngIf="form.controls.divetime.errors?.invalid">
                            Divetime must be a valid duration; eg. 00:00:00
                        </small>
                    </div>
                </div>
                <div [ngClass]="{ 'form-group':true, 'has-error': !form.controls.maxDepth.valid }">
                    <label class="col-sm-2 control-label">Max depth</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" formControlName="maxDepth" placeholder="0.00" /> <!-- number: "1.1-1" -->
                        <small class="help-text on-error" *ngIf="form.controls.maxDepth.errors?.required">
                            Max depth is required
                        </small>
                        <small class="help-text on-error" *ngIf="form.controls.maxDepth.errors?.pattern">
                            Max depth must be a valid numer; eg. 10.05
                        </small>
                    </div>
                </div>
                <div [ngClass]="{ 'form-group':true, 'has-error': !form.controls.tank.valid }">
                    <label class="hidden-xs col-sm-2 control-label">Tank</label>
                    <div class="col-sm-10">
                        
                        <div class="col-xs-6">
                            <span>
                                Tank Volume
                            </span>
                        </div>
                        <div class="col-xs-6">
                            <span>
                                Ogygen percentage
                            </span>
                        </div>
                        <div class="input-group-group" formGroupName="tank">
                            <div class="input-group">
                                <input type="text" class="form-control" formControlName="volume" placeholder="10" required />
                                <span class="input-group-addon">L</span>
                                <input type="text" class="form-control" formControlName="airPercentage" placeholder="21" required />
                                <span class="input-group-addon">%</span>
                            </div>
                            <div class="input-group" width="100%">
                                <input type="text" class="form-control" formControlName="pressureStart" placeholder="200" required />
                                <span class="input-group-btn" style="width:0px;"></span>
                                <input type="text" class="form-control" formControlName="pressureEnd" placeholder="50" required />
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{form.controls.tank.controls.pressureType.value}} <span class="caret"></span></button>
                                    <ul class="dropdown-menu dropdown-menu-right">
                                        <li><a (click)="form.controls.tank.controls.pressureType.setValue('bar')">bar</a></li>
                                        <li><a (click)="form.controls.tank.controls.pressureType.setValue('psi')">psi</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-xs-6">
                            <span>
                                Start Pressure
                            </span>
                        </div>
                        <div class="col-xs-6">
                            <span>
                                End Pressure
                            </span>
                        </div>

                        <small class="help-text on-error" *ngIf="form.controls.tank.controls.volume.errors?.required">
                            Tank volume is required
                        </small>
                        <small class="help-text on-error" *ngIf="form.controls.tank.controls.volume.errors?.invalid">
                            Tank volume must be a valid integer; eg 10
                        </small>
                        
                        <small class="help-text on-error" *ngIf="form.controls.tank.controls.airPercentage.errors?.required">
                            Oxygen percentage is required
                        </small>
                        <small class="help-text on-error" *ngIf="form.controls.tank.controls.airPercentage.errors?.invalid">
                            Oxygen percentage must be an integer number; eg 21
                        </small>

                        <small class="help-text on-error" *ngIf="form.controls.tank.controls.pressureStart.errors?.required">
                            Start pressure is required
                        </small>
                        <small class="help-text on-error" *ngIf="form.controls.tank.controls.pressureStart.errors?.invalid">
                            Start pressure must be a valid number; eg 10.05
                        </small>

                        <small class="help-text on-error" *ngIf="form.controls.tank.controls.pressureEnd.errors?.required">
                            End pressure is required
                        </small>
                        <small class="help-text on-error" *ngIf="form.controls.tank.controls.pressureEnd.errors?.invalid">
                            End pressure must be a valid number; eg 10.05
                        </small>
                        
                    </div>
                </div>
                <div [ngClass]="{ 'form-group':true, 'has-error': !form.controls.place.valid  }">
                    <label class="col-sm-2 control-label">Divespot</label>
                    <div class="col-sm-10">
                        
                        <div class="input-group manual-radius" style="width: 100%" formGroupName="place">
                            <app-autocomplete 
                                placeholder="Name"
                                inputClass="form-control left-control"
                                formControlName="name"
                                [source]="getDivespots.bind(this)"
                            ></app-autocomplete>
                            <span class="input-group-btn" style="width:0px;"></span>
                            <app-autocomplete 
                                placeholder="Country"
                                inputClass="form-control right-control"
                                formControlName="country"
                                [source]="getCountries.bind(this)"
                                display-item="description"
                                key-item="code"
                                forceSelection="true"
                            ></app-autocomplete>
                        </div>
                        <small class="help-text on-error">
                            Both or none need to be filled
                        </small>
                        
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">Buddies</label>
                    <div class="col-sm-10">
                        <app-tags-control formControlName="buddies" placeholder="Myke"></app-tags-control>
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-2 control-label">Tags</label>
                    <div class="col-sm-10">
                        <app-tags-control formControlName="tags"></app-tags-control>
                    </div>
                </div>

            </div>
            
            <div role="tabpanel" class="tab-pane" id="profile">
                <div class="form-group">
                    <label class="col-sm-2 control-label">Samples</label>
                    <div class="col-sm-10">
                        <p class="form-control-static">
                            {{dive.samples.length}}
                        </p>
                    </div>
                </div>
            </div>

            <div role="tabpanel" class="tab-pane" id="debug">
                <pre>
                    {{ diagnostic | json }}
                </pre>
            </div>
        </div>
    </div>
</form> 